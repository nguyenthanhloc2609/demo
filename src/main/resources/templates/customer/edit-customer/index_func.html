<script type="text/javascript" th:inline="javascript">
    $(function () {

        var id = /*[[${id}]]*/ {};

        console.log(id);
        getCustomer();

        var elem = document.getElementById("cusMoney");

        elem.addEventListener("keydown", function (event) {
            var key = event.which;
            if (key != 8 && key < 48 || (key > 57 && key < 96) || key > 105) event.preventDefault();
        });

        elem.addEventListener("keyup", function (event) {
            var value = this.value.replace(/\./g, "");
            this.dataset.currentValue = parseInt(value);
            var caret = value.length - 1;

            while ((caret - 3) > -1) {
                caret -= 3;
                value = value.split('');
                value.splice(caret + 1, 0, ".");

                value = value.join('');
            }
            this.value = value;
        });

        function formatMoney(money) {
            const thousands = /\B(?=(\d{3})+(?!\d))/g;
            return money.toString().replace(thousands, ".")
        }

        function getCustomer() {
            getRequest({
                url: '/customers/' + id,
                success: function (data) {
                    console.log(data);
                    $('#cusName').val(data.fullName || data.name);
                    $('#cusNick').val(data.name);
                    $('#cusPhone').val(data.phone);
                    $('#cusAddr').val(data.address);
                    $('#cusMoney').val(formatMoney(data.money));
                    $('#cusDiag').val(data.diag);
                    $('#cusBill').val(data.billing);
                    $('#cusNote').val(data.note);
                },
                error: function (e) {
                    console.log(e);


                }
            });
        }

        $('#update').click(function () {
            editCustomer();
        })

        function editCustomer() {
            var fullName = $('#cusName').val();
            var name = $('#cusNick').val();
            var phone = $('#cusPhone').val();
            var address = $('#cusAddr').val();
            var money = $('#cusMoney').val();
            money = money.replace('.', '');
            var diag = $('#cusDiag').val();
            var billing = $('#cusBill').val();
            var note = $('#cusNote').val();
            money = Number(money);

            let body = {
                id,
                fullName,
                name,
                billing,
                note,
                phone,
                address,
                diag,
                money
            }
            putRequest({
                url: '/customers/' + id,
                data: body,
                success: function (data) {
                    // console.log(data);
                    Swal.fire({
                        title: 'Cập nhật thông tin thành công',
                        icon: 'info',
                        confirmButtonText: 'OK',
                    }).then((result) => {
                        window.location = "/customer";
                    });
                },
                error: function (e) {
                    console.log(e);
                }
            });


        }

    });
</script>